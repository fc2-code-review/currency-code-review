<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <script src="webjars/jquery/3.3.1-2/jquery.min.js"></script>
    <title>환율 계산기</title>
</head>
<body>
<h1>환율 계산</h1>

<div>
    <label>송금국가:</label>
    <select id="sendingCountry">
        <option selected value="USD">미국(USD)</option>
        <option value="AUD">호주(AUD)</option>
    </select>
</div>

<div>
    <label>수취국가:</label>
    <select id="receivingCountry">
        <option selected value="KRW">한국(KRW)</option>
        <option value="JPY">일본(JPY)</option>
        <option value="PHP">필리핀(PHP)</option>
    </select>
</div>

<div>
    <label>환율:<span id="exchangeRate" th:text="${defaultExchangeRate}"></span></label>
</div>

<div>
    <label>송금액:</label>
    <input type="number" id="sendingAmount">
    <span id="sendingAmountCurrency">USD</span>
</div>

<div>
    <button type="button" onclick="getReceivingAmount()">Submit</button>
</div>

<div id="submitResponse">
</div>

</body>
<script>
    $('select').change(function () {
        var sendingCountry = $('#sendingCountry').val();
        var receivingCountry = $('#receivingCountry').val();

        $.ajax({
            url: "/api/exchange-rate?sendingCountry=" + sendingCountry + "&receivingCountry=" + receivingCountry,
            type: "GET",
            success: function (exchangeRate) {
                $('#exchangeRate').text(exchangeRate + " " + receivingCountry + "/" + sendingCountry);
                $('#sendingAmountCurrency').text(sendingCountry);
                $('#submitResponse').html("");
            },
            error: function () {
                alert("통신오류 메세지");
            }
        });
    });

    function isInvalidInput() {
        var amount = $('#sendingAmount').val();
        return (amount.length <= 0 || amount < 0 || amount > 10000);
    }

    function getReceivingAmount() {
        var sendingCountry = $('#sendingCountry').val();
        var receivingCountry = $('#receivingCountry').val();
        var sendingAmount = $('#sendingAmount').val();

        if (isInvalidInput()) {
            $('#submitResponse').html("<p style='color:red'>송금액이 바르지 않습니다</p>");
            return;
        }

        $.ajax({
            url: "/api/receiving-amount?sendingCountry=" + sendingCountry
                + "&receivingCountry=" + receivingCountry
                + "&amount=" + sendingAmount,
            type: "GET",
            success: function (responseMap) {
                $('#submitResponse').html("<p>수취금액은 " + responseMap.receivingAmount + " " + receivingCountry + "/USD 입니다.</p>");
                $('#exchangeRate').text(responseMap.exchangeRate + " " + receivingCountry + "/" + sendingCountry);
            },
            error: function () {
                alert("통신오류 메세지");
            }
        });
    }

    $('#sendingAmount').keydown(function (e) {
        if (e.which === 13) {
            getReceivingAmount();
        }
    });
</script>
</html>